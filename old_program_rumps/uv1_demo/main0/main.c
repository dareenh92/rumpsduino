//------------------------------------------------------------------------------
//
// Main Program
// Application    : LCD
// Core            : Any
// Purpose
//  - LCD drive

#include "main.h"
void main_scheduler (void);
void draw_star_group(unsigned short color1, unsigned short color2, unsigned short turn);
void draw_48x64(u8 index, u16 xsta, u16 ysta, u16 xoffset, u16 color1, u16 color2);



unsigned char star_show [42] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
                                 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                                 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                                 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                                 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                                 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                                 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
                				};


unsigned char star_group [42] = { 0x01, 0x02, 0x00, 0x02, 0x03, 0x01, 
                                  0x03, 0x01, 0x00, 0x02, 0x00, 0x02,
                                  0x01, 0x00, 0x03, 0x02, 0x03, 0x00,
                                  0x02, 0x03, 0x00, 0x03, 0x02, 0x01,
                                  0x03, 0x00, 0x02, 0x01, 0x03, 0x00,
                                  0x01, 0x02, 0x03, 0x02, 0x00, 0x03,
                                  0x02, 0x03, 0x01, 0x00, 0x02, 0x01
                                 };

// 0 1 2 3 4
// S L E P !
unsigned char s48x64[5][8][48] = {
	  {	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
		 0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0xF8,
		 0xF8,0xFC,0x7E,0x3E,0x3F,0x3F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,
		 0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1E,0x1C,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,
		 0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x0F,0x1F,0x1F,0x3F,0x7F,0x7F,
		 0x7E,0xFE,0xFE,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xF8,0xF8,0xF8,0xF8,
		 0xF8,0xF0,0xF0,0xF0,0xE0,0xE0,0xC0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x03,0x03,
		 0x03,0x07,0x07,0x0F,0x1F,0x3F,0xFF,0xFF,0xFF,0xFE,0xFC,0xF0,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0xE0,0xE0,0xE0,0xE0,0xE0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x80,0xC0,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x07,0x0F,0x3F,0x3F,0x7F,0xFF,0xFF,0xFE,0xFC,0xF8,0xF8,0xF0,
		 0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF8,0xF8,0xF8,
		 0xFC,0xFC,0x7E,0x7F,0x3F,0x3F,0x1F,0x0F,0x07,0x03,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x03,0x03,
		 0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x01,0x01,0x01,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	  },

	  { {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xF0,0xF0,0xF0,0xF0,0xF0,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xC0,0xC0,
	     0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xE0,0xE0,0xE0,0xE0,0xE0,0xF0,0xF0,
	     0xF0,0xF0,0xF0,0xF8,0xF8,0xF8,0xF8,0xF8,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x07,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,
	     0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x07,0x07,0x07,0x07,0x07,0x07,
	     0x03,0x03,0x03,0x03,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	  },

	  { {0x00,0x00,0x00,0x00,0xF0,0xF0,0xF0,0xF0,0xF0,0xE0,0xE0,0xF0,0xF0,0xF0,0xF0,0xF0,
	     0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,
	     0xF0,0xF0,0xF0,0xE0,0xE0,0xE0,0xE0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,
	     0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
	     0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0xC0,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xF0,0xF0,0xF0,0xF0,0xF0,0xF0,
	     0xF0,0xF0,0xF0,0xF0,0xF0,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,0xF8,
	     0xF8,0xF8,0xF8,0xF8,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,
	     0x03,0x03,0x03,0x03,0x03,0x03,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
	     0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x0F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x1F,0xFF,0xFF,0xFF,0xFF,0xFF,0xE0,0xC0,0xC0,0xC0,0xC0,0xC0,
	     0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,0xC0,
	     0xC0,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x07,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,
	     0x0F,0x0F,0x0F,0x0F,0x1F,0x1F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,0x0F,
	     0x0F,0x0F,0x0F,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	  },

	  { {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
	     0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xC0,0xC0,0xC0,0x80,0x80,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x07,0x07,0x07,
	     0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x0F,0x0F,0x1F,0x3F,0x7F,0xFF,0xFE,0xFC,
	     0xF8,0xF0,0xE0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
	     0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,0x80,0x80,
	     0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xC0,0xC0,0xE0,0xE0,0xF0,0xFC,0xFE,0xFF,0xFF,
	     0x7F,0x3F,0x0F,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x1F,0x1F,0x1F,
	     0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x0F,0x0F,0x07,0x07,0x03,0x03,0x01,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

	    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x07,0x07,0x07,0x07,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	     0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	  },

	  { {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xF0,
		 0xF0,0xF0,0xF0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
		 0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
		 0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
		 0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
		 0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x7F,
		 0x7F,0x7F,0x7F,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,
		 0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},

		{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
		 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x0F,
		 0x0F,0x0F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
	  }

	};


volatile unsigned int  sleep_count = 0, sleep_time = 0;

volatile unsigned char pressed = 0, sleep = 0, pressed_count = 0, long_pressed = 0;

volatile unsigned char noc_update = 0;

volatile unsigned int speed = 7;

//------------------------------------------------------------------------------
int main(void)
{
  unsigned int i, j, k;
  
  unsigned int speed_delay[8] = {3, 5, 8, 14, 24, 40, 65, 100};

  unsigned int active_OEN = 0x0;
  unsigned int active_PU = 0x0;

  Lcd_Init();

  LCD_Clear(RED);

  j = 0;

  speed = 7;

  pressed = 0;

  sleep_time = 24*16;

  //LCD_Show2Num(0xd0, 0x120, (7 - speed), 1, WHITE, RED);
  LCD_DrawThunder(0x06, 0x110, LIGHTBLUE, RED);
  LCD_DrawLine(0x06, 0x110, 0x1b, 0x12f, BLACK);
  LCD_DrawLine(0x07, 0x110, 0x1c, 0x12f, BLACK);
  LCD_DrawLine(0x08, 0x110, 0x1d, 0x12f, BLACK);
  LCD_DrawLine(0x1b, 0x110, 0x06, 0x12f, BLACK);
  LCD_DrawLine(0x1c, 0x110, 0x07, 0x12f, BLACK);
  LCD_DrawLine(0x1d, 0x110, 0x08, 0x12f, BLACK);
  
  //-----------------------------------------------------
  GPIO_OEN_CLR = 0x1;   // set GPIO_0 input

  MUXC_PU &= 0xfffffffe;  // turn off PU for GPIO_0 output

  //Enable processor's interrupt
  
  //set GPIO interrupt registers
  //GPIO_IT_SET = 0x1; // edge triggered
  GPIO_IT_CLR = 0x1; // level triggered
  GPIO_IP_CLR = 0x1; // low
  GPIO_IE_SET = 0x1; // GPIO_0

  GPIO_IF = 0x1;  // clear flag

  //* Ext INT 8 - GPIO0
  NVIC_SetPriority(8, 0);
  NVIC_EnableIRQ(8);


  //--------------------------------------------------
  //Timer Settings
  TM_PR = 0x400;       // prescale counter target value
  TM_COMR0 = 0x3D09/16;   // timer counter target value, channel 0
  TM_COMCR = 0x3;     // choose reset/stop upon reaching target value, enable interrupt

  TM_CTRL = 0x3;   // use PCLK, reset timer, enable timer
  TM_CTRL = 0x1;   // use PCLK, start timer, enable timer


  NVIC_SetPriority(6, 2);    // set Ext INT 6 (timer) priority
  NVIC_EnableIRQ(6);        // enable Ext INT 6 (timer)


  //--------------------------------------------------
  // NOC Settings
  IC_NOC_CSR1 = 0x04000000; // turn on NOC RX interrupt

  NVIC_SetPriority(4, 1);
  NVIC_EnableIRQ(4);
  

  //--------------------------------------------------
  while (1) {
    for (k = 0; ; k++){
      draw_star_group(WHITE, LGRAYBLUE, (k%4));

      for (i = 0; i < 600; i++){
        __NOP();
      }

      if ((k % (speed_delay[speed])) == 0) {
        if (star_show[j])
          star_show[j] = 0;
        else
          star_show[j] = 1;

        j = j +1;

        if (j == 42)
          j = 0;
      }

      //---------------------------------------------------------
      // button
      if (pressed == 0x1){
        pressed = 0;

        if (speed != 0)
          speed = speed - 1;
        else
          speed = 7;

        //LCD_Show2Num(0xd0, 0x120, (7 - speed), 1, WHITE, RED);


        if (speed != 7){
          for (i = 0; i < (7-speed); i++)
       	    LCD_DrawThunder(0x06 + (0x22*i), 0x110, LIGHTBLUE, RED);
          for (i = (7-speed); i < 8; i++)
            LCD_Fill((0x06 + (0x22*i)), 0x110, (0x28 + (0x22*i)), 0x130, RED);
        }
        else {
          for (i = 0; i < 8; i++)
        	LCD_Fill((0x06 + (0x22*i)), 0x110, (0x28 + (0x22*i)), 0x130, RED);
          LCD_DrawThunder(0x06, 0x110, LIGHTBLUE, RED);
          LCD_DrawLine(0x06, 0x110, 0x1b, 0x12f, BLACK);
          LCD_DrawLine(0x07, 0x110, 0x1c, 0x12f, BLACK);
          LCD_DrawLine(0x08, 0x110, 0x1d, 0x12f, BLACK);
          LCD_DrawLine(0x1b, 0x110, 0x06, 0x12f, BLACK);
          LCD_DrawLine(0x1c, 0x110, 0x07, 0x12f, BLACK);
          LCD_DrawLine(0x1d, 0x110, 0x08, 0x12f, BLACK);
        }
      }

      //---------------------------------------------------------
      if (noc_update == 0x1)
      {
    	noc_update = 0;

    	if (speed != 7){
    	  for (i = 0; i < (7-speed); i++)
    	    LCD_DrawThunder(0x06 + (0x22*i), 0x110, LIGHTBLUE, RED);
    	  for (i = (7-speed); i < 8; i++)
    	    LCD_Fill((0x06 + (0x22*i)), 0x110, (0x28 + (0x22*i)), 0x130, RED);
    	}
    	else {
    	  for (i = 0; i < 8; i++)
    	   	LCD_Fill((0x06 + (0x22*i)), 0x110, (0x28 + (0x22*i)), 0x130, RED);
    	  LCD_DrawThunder(0x06, 0x110, LIGHTBLUE, RED);
    	  LCD_DrawLine(0x06, 0x110, 0x1b, 0x12f, BLACK);
    	  LCD_DrawLine(0x07, 0x110, 0x1c, 0x12f, BLACK);
    	  LCD_DrawLine(0x08, 0x110, 0x1d, 0x12f, BLACK);
    	  LCD_DrawLine(0x1b, 0x110, 0x06, 0x12f, BLACK);
    	  LCD_DrawLine(0x1c, 0x110, 0x07, 0x12f, BLACK);
    	  LCD_DrawLine(0x1d, 0x110, 0x08, 0x12f, BLACK);
    	}
      }

      //---------------------------------------------------------
      if ((sleep_count >= sleep_time) && (sleep_count <= (sleep_time + 4)))
      {
    	sleep = 1;

    	LCD_Clear(BLACK);

    	draw_48x64(0x0, 0x04, 0x04, 0x00, WHITE, BLACK);
    	draw_48x64(0x1, 0x2c, 0x34, 0x04, WHITE, BLACK);
    	draw_48x64(0x2, 0x5c, 0x6c, 0x00, WHITE, BLACK);
    	draw_48x64(0x2, 0x88, 0xa0, 0x00, WHITE, BLACK);
    	draw_48x64(0x3, 0xb4, 0xd4, 0x00, WHITE, BLACK);
    	draw_48x64(0x4, 0xc0, 0x100, 0x00, WHITE, BLACK);

    	//active_OEN = GPIO_OEN_SET;
    	//active_PU = MUXC_PU;

    	//GPIO_OEN_CLR = 0xffffffff;
    	//MUXC_PU = 0xfffffffe;

    	GPIO_BSET = LCD_RS;
    	GPIO_BSET = LCD_WR;
    	GPIO_BSET = LCD_RD;
    	GPIO_BSET = LCD_CS;
    	GPIO_BSET = LCD_REST;

    	GPIO_DATAOUT |= LCD_DATA;

        __WFI();

    	//MUXC_PU = active_PU;
    	//GPIO_OEN_SET = active_OEN;

        LCD_Clear(RED);

        //LCD_Show2Num(0xd0, 0x120, (7 - speed), 1, WHITE, RED);

        if (speed != 7){
          for (i = 0; i < (7-speed); i++)
            LCD_DrawThunder(0x06 + (0x22*i), 0x110, LIGHTBLUE, RED);
          for (i = (7-speed); i < 8; i++)
            LCD_Fill((0x06 + (0x22*i)), 0x110, (0x28 + (0x22*i)), 0x130, RED);
        }
        else {
          for (i = 0; i < 8; i++)
           	LCD_Fill((0x06 + (0x22*i)), 0x110, (0x28 + (0x22*i)), 0x130, RED);
          LCD_DrawThunder(0x06, 0x110, LIGHTBLUE, RED);
          LCD_DrawLine(0x06, 0x110, 0x1b, 0x12f, BLACK);
          LCD_DrawLine(0x07, 0x110, 0x1c, 0x12f, BLACK);
          LCD_DrawLine(0x08, 0x110, 0x1d, 0x12f, BLACK);
          LCD_DrawLine(0x1b, 0x110, 0x06, 0x12f, BLACK);
          LCD_DrawLine(0x1c, 0x110, 0x07, 0x12f, BLACK);
          LCD_DrawLine(0x1d, 0x110, 0x08, 0x12f, BLACK);
        }
      }
    }
  }
   
  return 0;
}

void draw_star_group(unsigned short color1, unsigned short color2, unsigned short turn)
{
  unsigned short i, j, k;

  for (i = 0; i < 7; i++){
    for (j = 0; j < 6; j++){
      k = (i*6) + j;

      if (star_show[k] == 1){
        if (star_group [k] == turn)
          LCD_DrawStar24 ((0x0c + (0x24 * j)), (0x0c + (0x24 * i)), color2, RED);
        else
          LCD_DrawStar24 ((0x0c + (0x24 * j)), (0x0c + (0x24 * i)), color1, RED);
      }
      else
        LCD_Fill((0x0c + (0x24 * j)), (0x0c + (0x24 * i)), (0x24 + (0x24 * j)), (0x24 + (0x24 * i)), RED);
    }
  }

}
  

void draw_48x64(u8 index, u16 xsta, u16 ysta, u16 xoffset, u16 color1, u16 color2)
{
  u16 i, j, k;

  for(i=0; i<8; i++)
  {
    for(j=xoffset; j<48; j++){
      Address_set(xsta+j,(ysta + (8*i)),xsta+j ,(ysta + (8*i) + 7));      // area

      for (k = 0; k < 8; k++){
    	if (((s48x64[index][i][j]>> k) & 0x1) == 0x1){
    	  LCD_WR_DATA(color1); // fill
    	}
    	else{
      	  LCD_WR_DATA(color2); // fill
    	}
      }
    }
  }
}

